Chef-Berksfile-Env
==================

A Chef plugin which allows you to lock down your Chef Environment with a Berksfile.

Installation
------------

    /opt/chef/embedded/bin/gem install chef-berksfile-env

Usage
-----

In your chef repo create a Berksfile next to your Chef environment file like this,

    chef-repo/environments/[ENV_NAME]/Berksfile

This is the default location that will used by the plugin. We have to put the berkshelf in its own
directory since [multiple berksfiles can't exist in the same directory](https://github.com/berkshelf/berkshelf/issues/1247). 

The berksfile should include any cookbooks that your nodes or roles explicitly mention for that environment,

    source "https://supermarket.getchef.com"

    cookbook "java"
    cookbook "yum", "~> 2.0"
    ...

Next we need to generate our Berksfile's lock file,

    berks install

Your environment file must by in `.rb` format and look like this,

    require 'chef-berksfile-env'
    
    # This must be define before we do load_berksfile
    name "my_env"
    
    # Load Berksfile locked dependencies as my environments version contraints
    load_berksfile

    ...

Now our environment will only use the locked versions of the cookbooks generated by our Berksfile. Additionally
Berkshelf has also locked all transitive dependencies for us as well. Upgrading to the latest dependecies is now as simple as,

    berks install

Our Berksfile also provides an easy way to ensure all the cookbooks and their versions that our environment requires 
are uploaded to our chef-server,

    berks upload